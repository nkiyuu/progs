# Tetris AI

プログラミング勉強会 #09 課題

### 概要
テトリスを行う AI を実装してください。テトリスのゲーム自体は用意されているので、テトリスの操作部分を実装することになります。

### 動作環境
ゲームは Ruby で実装され、表示処理に Curses を使用しています。それらが動作する必要があります。

### 実装対象の詳細 (ai.rb)
ai.rb ファイル内に AI クラスの雛形があります。このクラスを拡張してテトリスを行うことができるようにしますが、以下の形式を守ってください。

    class AI
        ...
        def update(controller)
            # do stuff
        end
        ...
    end

このようにクラス名と update 関数を書いていれば、後は基本的に何をどうしても良いです。

### ゲームの流れ (main.rb)
起動からゲーム内処理、終了までの大まかな流れを示します。

0. 起動  
    `ruby main.rb`
0. 初期化
    - 色々生成
    - Curses 関連の初期化
0. 表示内容の設定 (※1)
0. ゲームループ
    1. AI の処理 (ai.update)
    1. ゲーム内処理
    1. 描画
0. 終了処理
    - Curses 関連の終了処理
0. 終了
    - 現状自動的に終了しないので、適宜 Ctrl+C 等で終了してください

※1 main.rb は基本的に修正する必要はありませんが、デバッグやもっとリッチな見た目にするために、新たに表示内容を追加することができます（後述）。

次に、ゲームループについてもう少し詳しく説明します。

###### 1.　AIの処理  
ここでは、ai.rb 内の update 関数が呼びだされます。controller が渡され、このオブジェクトからゲーム内の情報の取得やテトリスの操作を行います。

###### 2.　ゲーム内処理  
ここでは、テトリス側の処理を以下の流れで行います。

1. 操作可能なミノが無ければ、Next から1つ取り出して操作可能なミノとする
1. 1マス落下するか、落下できず、かつAI側で何も操作されていなければ現在のテトリミノを固定する
1. 固定したミノのあるラインが全て埋まっていれば、そのラインを空にし、詰める

### コントローラーを通してできること
controller が持つ関数の説明をします。コントローラーから得られるテトリミノやボードの要素は呼び出し時点の状態のコピーなので、これらのオブジェクトから操作しても反映されません。

|関数名|説明|
|:---|:---|
|`move_left`|現在のテトリミノを1マス左に移動させる|
|`move_right`|現在のテトリミノを1マス右に移動させる|
|`rotate_cw`|現在のテトリミノを時計回りに回転させる|
|`rotate_ccw`|現在のテトリミノを反時計回りに回転させる|
|`fall_down`|現在のテトリミノを移動できるだけ下に移動させ、固定する|
|`get_cmino`|現在のテトリミノのコピーを取得する|
|`get_nexts`|次に出現するテトリミノを5つ先まで取得する|
|`get_board`|現在のボードのコピーを取得する（現在のテトリミノは含まれない）|
|`get_clrline_num`|消したライン数を取得する|
|`get_spawn_num`|出現したテトリミノの数を取得する|
|`get_time`|ゲーム開始から現在までの、経過時間（テトリス側の処理が呼ばれた回数）を取得する|

### テトリミノを通してできること
`get_cmino`で取得したオブジェクトが持つ関数の説明をします。

|関数名|説明|
|:---|:---|
|`x`|X 座標の位置を取得する (変数)|
|`y`|X 座標の位置を取得する (変数)|
|`cw`|時計回りに回転させる|
|`ccw`|反時計回りに回転させる|
|`width`|幅を取得する|
|`height`|高さを取得する|
|`each{|u,v,bt|}`|テトリミノの座標系において、全体にわたってブロックの種類 bt とその位置 (u, v) を引数として繰り返し処理を行う|

###### ※ 座標系について
テトリミノやボードの座標系は、画面から見て左下が (0, 0) で右に向かって X 軸正の方向、上に向かって Y 軸正の方向となるように増加します。

### ボードを通してできること
`get_board`で取得したオブジェクトが持つ関数の説明をします。ボードは、表示されるのは 20 ラインまでのブロックですが、実際は 24 ライン持っています。

|関数名|説明|
|:---|:---|
|`set(x, y, type)`|位置 (x, y) にブロックの種類 bt を埋める|
|`at(x, y, type)`|位置 (x, y) のブロックの種類を取得する|
|`placeable?(x, y, mino)`|位置 (x, y) を起点として mino を設置可能か調べ、真偽値を返す|
|`filled_line?(line)`|下から line+1 番目のラインが全てブロックで埋まっているかを調べ、真偽値を返す|
|`shrink_line(line)`|line+1 番目のラインを消去し、詰める|
|`each({|x,y,bt|})`|ボードの座標系において、全体にわたってブロックの種類 bt とその位置 (x, y) を引数として繰り返し処理を行う|

### ブロックの種類
テトリミノ I, O, S, Z, J, L, T を構成するブロックがそれぞれあり、 `BlockType::?`(?はブロックの種類) で表されます。また、`BlockType::EMPTY`はブロックがないことを表します。

### その他
その他不明点や機能拡張の要望がありましたら hayashima@dc.tohoku.ac.jp まで連絡をください。
